# 随机取出其中之一元素

## 题目描述

一个文件中含有n个元素，只能遍历一遍，要求等概率随机取出其中之一。

## 分析与解法

如果5个人轮流抽签，只有其中某一个能中签，那么5个人每个人中签的概率是相等的。但不排除可能有些读者觉得先抽的人中签的概率会大些，后抽的中签概率会小点，其实不然，不信的话，咱们可以具体计算下。

首先，第一个人中签的概率是1/5,第二个人中签的情况只能在第一个人未中时才有可能，所以他中的概率是4/5 X 1/4 = 1/5（4/5表示第一个人未中，1/4表示在剩下的4个签里中签的概率），所以，第二个人最终的中签概率也是1/5，

同理，第三个人中签的概率为：第一个人未中的概率 * 第二个人未中的概率 * 第三个人中的概率，即为：4/5 * 3/4 * 1/3 = 1/5，

一样的可以求出第四和第五个人的概率都为1/5，也就是说先后顺序不影响公平性。

## 我的策略

下面，说一个个人认为比较满足要求的选取策略：

顺序遍历，当前遍历的元素为第L个元素，变量e表示之前选取了的某一个元素，此时生成一个随机数r，如果r%L == 0(当然0也可以是0~L-1中的任何一个，概率都是一样的), 我们将e的值替换为当前值，否则扫描下一个元素直到文件结束。

你要是给面试官说明了这样一个策略后，面试官百分之一千会问你这样做是等概率吗？那我们来证明一下。

## 蓄水池算法的证明

在遍历到第1个元素的时候，即L为1，那么r%L必然为0，所以e为第一个元素，p=100%，

遍历到第2个元素时，L为2，r%L==0的概率为1/2, 这个时候，第1个元素不被替换的概率为1*(1-1/2)=1/2,

第1个元素被替换，也就是第2个元素被选中的概率为1/2,你可以看到，只有2时，这两个元素是等概率的机会被选中的。

继续，遍历到第3个元素的时候，r%L==0的概率为1/3，前面被选中的元素不被替换的概率为1/2*(1-1/3)=1/3,前面被选中的元素被替换的概率，即第3个元素被选中的概率为1/3。

归纳法证明，这样走到第L个元素时，这L个元素中任一被选中的概率都是1/L，那么走到L+1时，第L+1个元素选中的概率为1/(L+1), 之前选中的元素不被替换，即继续被选中的概率为1/L*(1-1/(L+1)) = 1/(L+1)。证毕。

也就是说，走到文件最后，每一个元素最终被选出的概率为1/n， n为文件中元素的总数。好歹我们是一个技术博客，看不到一丁点代码多少有点遗憾，给出一个选取策略的伪代码，如下：

__伪代码__
```
  Element RandomPick(file):
  Int length = 1;
  While (length <= file.size)
    If (rand() % length == 0)
      Picked = File[length];
    Length++;
  Return picked
```

近日，看见我的一些同学在他们的面经里面常推荐结构之法算法之道这个博客，感谢东南大学计算机学院即将找工作的同学们对本博的关注，欢迎批评指正！--__BigPotato__。

## 类似问题

一个文件含有n个元素, n未知的情况下, 顺序遍历一遍, 要求等概率随机取r个，其中r < n。
